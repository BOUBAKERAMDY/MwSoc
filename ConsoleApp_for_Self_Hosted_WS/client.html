<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Let's Go Biking! â€“ Test Client</title>
  <style>
    :root { --brand:#0078d7; }
    body { font-family: system-ui, Arial, sans-serif; background:#f5f7fb; margin:32px; color:#222; }
    h1 { color:var(--brand); margin-bottom:16px; }
    .card { background:#fff; border-radius:14px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,.06); max-width:820px; }
    label { display:block; font-weight:600; margin-top:12px; }
    input {
      width:100%; padding:10px 12px; margin-top:6px; border:1px solid #d7dbe3; border-radius:10px;
      font-size:14px; outline:none;
    }
    input:focus { border-color: var(--brand); box-shadow:0 0 0 3px rgba(0,120,215,.12); }
    .row { display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
    button {
      background:var(--brand); color:#fff; border:0; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:600;
    }
    button.secondary { background:#edf2f7; color:#2b2f36; }
    .muted { color:#6b7280; font-size:12px; margin-top:6px; }
    .result { margin-top:18px; display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    .tile { background:#fafbff; border:1px solid #e6e9f2; border-radius:12px; padding:14px; }
    .kpi { font-size:26px; font-weight:800; }
    .kpi small { font-size:12px; font-weight:600; color:#6b7280; margin-left:4px; }
    .mono { background:#111; color:#e7e7e7; padding:10px; border-radius:10px; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; }
    .err { color:#b00020; font-weight:700; }
  </style>
</head>
<body>
  <h1>ðŸš² Let's Go Biking â€“ REST Client</h1>
  <div class="card">
    <label>Origen</label>
    <input id="origin" placeholder="Ej.: 43.701,7.268 o Nice Cathedral" />
    <label>Destino</label>
    <input id="destination" placeholder="Ej.: 43.695,7.283 o Massena" />

    <div class="row">
      <button onclick="getItinerary()">Buscar itinerario</button>
      <button class="secondary" onclick="demo()">Demo coords</button>
    </div>

    <div class="muted" id="url">AÃºn no se ha consultado nada.</div>

    <div id="pretty" class="result" style="display:none;">
      <div class="tile">
        <div class="kpi" id="totalTime">â€“</div>
        <div class="muted">Tiempo total</div>
      </div>
      <div class="tile">
        <div class="kpi" id="totalKm">â€“</div>
        <div class="muted">Distancia total</div>
      </div>
      <div class="tile">
        <div class="kpi" id="walk1">â€“</div>
        <div class="muted">Caminar â†’ estaciÃ³n</div>
      </div>
      <div class="tile">
        <div class="kpi" id="bike">â€“</div>
        <div class="muted">Tramo en bici</div>
      </div>
      <div class="tile">
        <div class="kpi" id="walk2">â€“</div>
        <div class="muted">Caminar â†’ destino</div>
      </div>
      <div class="tile">
        <div class="kpi" id="stations">â€“</div>
        <div class="muted">Estaciones (origen â†’ destino)</div>
      </div>
    </div>

    <h3 style="margin-top:18px;">Respuesta cruda</h3>
    <pre id="raw" class="mono">Sin datos.</pre>
  </div>

  <script>
    const fmtTime = s => {
      if (!s || s<=0) return '0 s';
      const m = Math.floor(s/60), sec = s%60;
      return m ? `${m} min ${sec}s` : `${sec} s`;
    };
    const fmtKm = km => (km ?? 0).toFixed(3) + ' km';
    const fmtMeters = m => Math.round(m ?? 0) + ' m';

    const normalizeLatLon = t => (t || '').replace(/\s*,\s*/g, ',').trim();

    function demo() {
      document.getElementById('origin').value = '43.701, 7.268';
      document.getElementById('destination').value = '43.695, 7.283';
    }

    async function getItinerary() {
      let origin = normalizeLatLon(document.getElementById('origin').value);
      let destination = normalizeLatLon(document.getElementById('destination').value);
      if (!origin || !destination) { alert('Introduce ambos campos'); return; }

      const url = `http://localhost:8090/MyService/Itinerary?origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(destination)}`;
      document.getElementById('url').textContent = 'Consultando: ' + url;
      document.getElementById('raw').textContent = 'Cargando...';
      document.getElementById('pretty').style.display = 'none';

      try {
        const res = await fetch(url);                 // requiere CORS (ya activado en Program.cs)
        if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
        const data = await res.json();

        // pinta KPIs
        document.getElementById('totalTime').textContent = fmtTime(data.TotalSeconds);
        document.getElementById('totalKm').textContent   = fmtKm(data.TotalKm);
        document.getElementById('walk1').textContent     = `${fmtMeters(data.WalkToStartMeters)} Â· ${fmtTime(data.WalkToStartSeconds)}`;
        document.getElementById('bike').textContent      = `${fmtMeters(data.BikeMeters)} Â· ${fmtTime(data.BikeSeconds)}`;
        document.getElementById('walk2').textContent     = `${fmtMeters(data.WalkToEndMeters)} Â· ${fmtTime(data.WalkToEndSeconds)}`;
        document.getElementById('stations').textContent  = `${data.StartStation ?? 'â€”'} â†’ ${data.EndStation ?? 'â€”'}`;

        document.getElementById('pretty').style.display = 'grid';
        document.getElementById('raw').textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById('raw').textContent = 'Error: ' + err + '\nÂ¿EstÃ¡ en ejecuciÃ³n el servidor? Â¿CORS activado en Program.cs?';
      }
    }
  </script>
</body>
</html>